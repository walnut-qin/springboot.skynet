<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kaos.his.mapper.personnel.OutpatientMapper">
    <resultMap id="resultMap" extends="com.kaos.his.mapper.personnel.DeptpatientMapper.resultMap" type="com.kaos.his.entity.personnel.Outpatient">
        <id column="CLINIC_CODE" jdbcType="VARCHAR" property="clinicCode"/>
        <result column="STATE" jdbcType="VARCHAR" property="state"/>
    </resultMap>

    <select id="GetOutpatientByClinicCode" resultMap="resultMap">
        SELECT
            T1.CLINIC_CODE AS CLINIC_CODE,
            T1.IN_STATE AS STATE,
            T1.OPER_DATE AS OPER_DATE,
            T1.OPER_CODE AS OPER_CODE,
            T2.EMPL_NAME AS OPER_NAME,
            T2.SEX_CODE AS OPER_SEX,
            T2.BIRTHDAY AS OPER_BIRTHDAY,
            T2.IDENNO AS OPER_IDENTITY_NO,
            T2.TEL AS OPER_PHONE_NO,
            T2.EMAIL AS OPER_EMAIL,
            T2.DEPT_ID AS OPER_DEPT_CODE,
            T3.DEPT_NAME AS OPER_DEPT_NAME,
            T3.DEPTOWN AS OPER_DEPT_DEPTOWN,
            T1.DEPT_CODE AS DEPT_CODE,
            T4.DEPT_NAME AS DEPT_NAME,
            T4.DEPTOWN AS DEPT_DEPTOWN,
            T1.CARD_NO AS CARD_NO,
            T5.GCPOUTPATIENT AS GCPOUTPATIENT,
            T5.NAME AS NAME,
            T5.SEX_CODE AS SEX,
            T5.BIRTHDAY AS BIRTHDAY,
            T5.IDENNO AS IDENTITY_NO,
            NVL(T5.WORK_TEL, NVL(T5.HOME_TEL, T5.LINKMAN_TEL)) AS PHONE_NO,
            T5.EMAIL AS EMAIL
        FROM
            FIN_OPR_REGISTER T1
            LEFT JOIN DAWN_ORG_EMPL T2 ON T2.EMPL_ID = T1.OPER_CODE AND T2.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_DEPT T3 ON T3.DEPT_ID = T2.DEPT_ID AND T3.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_DEPT T4 ON T4.DEPT_ID = T1.DEPT_CODE AND T4.VALID_STATE = '1'
            LEFT JOIN COM_PATIENTINFO T5 ON T5.CARD_NO = T1.CARD_NO
        WHERE
            T1.CLINIC_CODE = #{clinicCode}
    </select>

    <select id="GetOutpatientsByCardNo" resultMap="resultMap">
        SELECT
            T1.CLINIC_CODE AS CLINIC_CODE,
            T1.IN_STATE AS STATE,
            T1.OPER_DATE AS OPER_DATE,
            T1.OPER_CODE AS OPER_CODE,
            T2.EMPL_NAME AS OPER_NAME,
            T2.SEX_CODE AS OPER_SEX,
            T2.BIRTHDAY AS OPER_BIRTHDAY,
            T2.IDENNO AS OPER_IDENTITY_NO,
            T2.TEL AS OPER_PHONE_NO,
            T2.EMAIL AS OPER_EMAIL,
            T2.DEPT_ID AS OPER_DEPT_CODE,
            T3.DEPT_NAME AS OPER_DEPT_NAME,
            T3.DEPTOWN AS OPER_DEPT_DEPTOWN,
            T1.DEPT_CODE AS DEPT_CODE,
            T4.DEPT_NAME AS DEPT_NAME,
            T4.DEPTOWN AS DEPT_DEPTOWN,
            T1.CARD_NO AS CARD_NO,
            T5.GCPOUTPATIENT AS GCPOUTPATIENT,
            T5.NAME AS NAME,
            T5.SEX_CODE AS SEX,
            T5.BIRTHDAY AS BIRTHDAY,
            T5.IDENNO AS IDENTITY_NO,
            NVL(T5.WORK_TEL, NVL(T5.HOME_TEL, T5.LINKMAN_TEL)) AS PHONE_NO,
            T5.EMAIL AS EMAIL
        FROM
            FIN_OPR_REGISTER T1
            LEFT JOIN DAWN_ORG_EMPL T2 ON T2.EMPL_ID = T1.OPER_CODE
            LEFT JOIN DAWN_ORG_DEPT T3 ON T3.DEPT_ID = T2.DEPT_ID
            LEFT JOIN DAWN_ORG_DEPT T4 ON T4.DEPT_ID = T1.DEPT_CODE
            LEFT JOIN COM_PATIENTINFO T5 ON T5.CARD_NO = T1.CARD_NO
        WHERE
            T1.CARD_NO = #{cardNo}
        ORDER BY
            T1.OPER_DATE ASC
    </select>
</mapper>